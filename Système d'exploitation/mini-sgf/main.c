
/*
**  main.c
**
**  Utilisation des fonctions du mini SGF.
**
**  04/04/2007
*/

#include <stdio.h>
#include <stdlib.h>

#include "sgf-disk.h"
#include "sgf-fat.h"
#include "sgf-dir.h"
#include "sgf-io.h"

int main() {
	OFILE* file;
	int c = 0;
	
	init_sgf();
	
	printf("===> Listing du disque\n");
	list_directory();
	
/******************** FONCTION SEEK **********************/

	file = sgf_open("essai.txt", READ_MODE);
  c = sgf_seek(file,7);
	while ((c = sgf_getc(file)) > 0) {
		putchar(c);
	    c = sgf_seek(file,7);
        if(c != 0) break;
	}
	sgf_close(file);

/******************** FONCTION REMOVE **********************/
 /*   printf("===> Modification du fichier essai.txt\n");
    file = sgf_open("essai.txt", WRITE_MODE);

    sgf_puts(file, "Ceci est un petit texte \n");
    sgf_puts(file, "Il n a rien de particulier \n");
    sgf_puts(file, "Mais il a ete remplace avec la fonction \n");
    sgf_puts(file, "sgf_puts alors ce n est pas rien ! \n");
    sgf_puts(file, "Nous sommes fieres de ce fichier. \n");
    sgf_close(file);
    printf("===> Création du fichier essai2.txt\n");
    OFILE* fileWrite = sgf_open("essai2.txt", WRITE_MODE);
    sgf_puts(fileWrite, "Le systeme est ma matiere preferee\n");
    sgf_puts(fileWrite, "On apprend a faire pleins de choses simples \n");
    sgf_puts(fileWrite, "De maniere tres complique\n");
    sgf_close(fileWrite);

    printf("===> Listing du disque\n");
    list_directory();

    printf("===> Lecture du fichier essai.txt\n");
   
    OFILE* fileRead = sgf_open("essai.txt", READ_MODE);
    while((c = sgf_getc(fileRead)) > 0) {
        putchar(c);
    }

    sgf_close(fileRead);
    
    printf("===> Lecture du fichier essai2.txt\n");

    OFILE* essai2 = sgf_open("essai2.txt", READ_MODE);
    
    while((c = sgf_getc(essai2)) > 0) {
        putchar(c);
    }

    sgf_close(essai2);

    printf("===> Vidage du fichier \"essai.txt\"\n");
    OFILE* essai2Delete = sgf_open("essai.txt", WRITE_MODE);
    sgf_remove(essai2Delete->inode);
    sgf_close(essai2Delete);
    delete_inode("essai.txt");
    printf("===> Listing du disque\n");
    list_directory();
    
*/    
/******************** FONCTION APPEND **********************/
/*  printf("===> Création du fichier essai2.txt\n");
  OFILE* fileWrite = sgf_open("essai2.txt", WRITE_MODE);
  sgf_puts(fileWrite, "Le systeme est ma matiere preferee\n");
  sgf_puts(fileWrite, "On apprend a faire pleins de chosess simple \n");
  sgf_puts(fileWrite, "De maniere tres complique\n");
  sgf_close(fileWrite);

  printf("===> Listing du disque\n");
  list_directory();
    
  printf("===> Lecture du fichier essai2.txt\n");

  OFILE* essai2 = sgf_open("essai2.txt", READ_MODE);
  
  while((c = sgf_getc(essai2)) > 0) {
      putchar(c);
  }

  sgf_close(essai2);

  /*printf("===> Vidage du fichier essai2.txt\n");
  OFILE* essai2Delete = sgf_open("essai2.txt", WRITE_MODE);
  sgf_remove(essai2Delete->inode);*/
  
/* Realisation de la boucle Append */
/*  printf("===> Remplissage du fichier essai2.txt de \"a\"\n");
  
  int j;
  for(j = 0; j < 2; ++j)
  {
    OFILE* essai2Append = sgf_open("essai2.txt", APPEND_MODE);
    essai2Append->buffer[0] = 'a';
    sgf_append_block(essai2Append); 
    sgf_close(essai2Append);
  }    
  
  printf("===> Lecture du fichier essai2.txt\n");
  OFILE* essai2Lecture = sgf_open("essai2.txt", READ_MODE);
  
  while((c = sgf_getc(essai2Lecture)) > 0) {
      putchar(c);
  }
*/
	return (EXIT_SUCCESS);
}

